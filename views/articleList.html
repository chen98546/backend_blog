<!-- 继承公共模板 -->
{{extend './common/page.html'}}



<!-- 头部区域 -->
{{block 'title'}}

<title>博客后台管理系统</title>
<link rel="stylesheet" href="/layui/css/layui.css">
<style>
    .laytable-cell-1-0-7 {
        height: 40px;
        line-height: 40px;
    }

    .layui-table-cell {
        text-align: center;
    }

    .layui-btn {
        height: 30px;
        line-height: 30px;
    }
</style>
{{/block}}




<!-- body主体内容区域 -->
{{block 'content'}}

<div class="layui-layout layui-layout-admin">

    <!-- 头部菜单栏 -->
    {{include "./common/header.html"}}

    <!-- 左侧菜单栏 -->
    {{include "./common/leftMenu.html"}}



    <div class="layui-body">
        <!-- 内容主体区域 -->
        <table id="table" lay-filter="table"></table>
    </div>

    <div id="toolbarDemo">
        <button class="deleteBtn layui-btn layui-btn-primary layui-border-red" lay-event="del" title="删除">
            <i class="layui-icon">&#xe640;</i>删除
        </button>
        <button class="putBtn layui-btn layui-btn-primary layui-border-blue" lay-event="edit" title="编辑">
            <i class="layui-icon">&#xe642;</i>编辑
        </button>
    </div>

    <!-- 底部 -->
    {{include "./common/footer.html"}}

</div>

{{/block}}





{{block 'script'}}

<script src="/layui/layui.js"></script>
<script>
    layui.use(['element', 'layer', 'table', 'util'], function () {
        var element = layui.element,
            layer = layui.layer,
            table = layui.table,
            util = layui.util,
            $ = layui.$;

        // 头部事件
        util.event('lay-header-event', {
            //左侧菜单事件
            menuLeft: function (othis) {
                layer.msg('展开左侧菜单的操作111', {
                    icon: 0
                });
            },
            menuRight: function () {
                layer.open({
                    type: 1,
                    content: '<div style="padding: 15px;">处理右侧面板的操作234</div>',
                    area: ['260px', '100%'],
                    offset: 'rt', //右上角
                    anim: 5,
                    shadeClose: true
                });
            }
        });

        // 表单
        table.render({
            elem: '#table',
            height: 510,
            url: '/getArticleList', //数据接口
            page: true, //开启分页
            cols: [
                [ //表头
                    {
                        field: 'id',
                        title: 'ID',
                        width: 60,
                        // sort: true,
                        // fixed: 'left'
                    }, {
                        field: 'title',
                        title: '标题',
                        width: 80,
                        edit: true

                    }, {
                        field: 'content',
                        title: '内容',
                        width: '25%',
                        edit: true

                    }, {
                        field: 'author',
                        title: '作者',
                        width: 80,
                        edit: true

                    }, {
                        field: 'status',
                        title: '审核',
                        width: 80,
                        edit: true

                    }, {
                        field: 'add_date',
                        title: '添加时间',
                        width: 220,
                        sort: true,
                        edit: true

                    }, {
                        field: 'cate_id',
                        title: '分类',
                        width: 80,
                        edit: true

                    }, {
                        title: '操作',
                        width: 220,
                        toolbar: '#toolbarDemo'
                    },
                ]
            ]


        });

        // 工具条事件
        table.on('tool(table)', function (obj) {
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）

            let {
                id,
                title,
                content,
                author,
                status,
                add_date,
                cate_id
            } = data;

            if (layEvent === 'del') {
                layer.confirm('确认删除', function (index) {
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    //向服务端发送删除指令

                    $.ajax({
                        type: 'delete',
                        url: '/deleteArticle?id=' + id
                    })

                });
            } else if (layEvent === 'edit') {

                //同步更新缓存对应的值
                obj.update({
                    id,
                    title,
                    content,
                    author,
                    status,
                    add_date,
                    cate_id
                });

                $.ajax({
                    type: 'put',
                    url: '/updateArticle',
                    data: {
                        id,
                        title,
                        content,
                        author,
                        status,
                        add_date,
                        cate_id
                    }
                }).then(res => {
                    console.log(res);
                })
            }
        });


    })
</script>

{{/block}}